---
title: "Encrypted Data Storage with Nillion Blind Computing"
description: "Store encrypted data on Arweave and control access through Nillion's decentralized blind computing network"
---

import { Shield, Key, Database, Lock, Eye, Code } from "lucide-react";

Store **encrypted data permanently** on Arweave while controlling access through **Nillion's nilCC confidential compute platform**. This approach ensures your data remains encrypted on Arweave, decryption keys are securely stored in **nilDB** (Private Storage), and authorized users can access processed results through **confidential VMs** running Docker containers with AMD SEV-SNP hardware security.

Arweave provides **permanent, immutable storage** for encrypted data, while Nillion's **nilDB** stores decryption keys encrypted and split across multiple nodes. Authorized users can then trigger **nilCC workloads** (Docker containers in confidential VMs) that fetch encrypted data from Arweave, decrypt it blindly within the TEE, and return only processed resultsâ€”with cryptographic attestation proving the computation happened securely.

## Prerequisites

Before starting, you'll need to complete Nillion's 3-step developer flow:

<Steps>
  <Step>
    ### Create Wallet & Get Tokens

    **Create a Nillion Wallet:**
    - Visit [Nillion Wallet Guide](https://docs.nillion.com/community/guides/nillion-wallet)
    - Set up your wallet for the Nillion network

    **Get Testnet NIL Tokens:**
    - Visit [NIL Faucet](https://faucet.testnet.nillion.com/)
    - Get testnet NIL tokens to start building

  </Step>

  <Step>
    ### Subscribe to Services

    **Subscribe to nilDB Service:**
    - Visit [nilPay Subscription](https://nilpay.vercel.app/)
    - Pay NIL tokens for nilDB service subscription
    - Receive your Nillion API Key for Private Storage

    **Note:** You need a valid API key to access Nillion's Private Storage services.

  </Step>

  <Step>
    ### Set Up Development Environment

    **Install Required Dependencies:**
    ```bash
    npm install @nillion/secretvaults @nillion/nuc
    ```

    **Configure Network:**
    - Use testnet endpoints for development
    - Configure multiple nilDB node URLs (typically 3 nodes)
    - Set up your API key from the subscription

  </Step>
</Steps>

## Setting Up Nillion Access Control

<Steps>
  <Step>
    ### Initialize Builder and User Clients

    Set up Nillion's native access control system using Builder and User clients:

    ```javascript
    import { SecretVaultBuilderClient, SecretVaultUserClient } from '@nillion/secretvaults'
    import { generateKeyPair } from '@nillion/nuc'

    // Initialize Builder Client (for creating collections and managing access)
    const builderClient = new SecretVaultBuilderClient({
      keypair: yourKeypair, // From your Nillion API Key
      urls: {
        chain: 'http://rpc.testnet.nilchain-rpc-proxy.nilogy.xyz',
        auth: 'https://nilauth.sandbox.app-cluster.sandbox.nilogy.xyz',
        dbs: [
          'https://nildb-stg-n1.nillion.network',
          'https://nildb-stg-n2.nillion.network',
          'https://nildb-stg-n3.nillion.network'
        ]
      },
      blindfold: { operation: 'store' }
    })

    // Refresh authentication tokens
    await builderClient.refreshRootToken()

    // Register builder profile (one-time setup)
    await builderClient.register({
      did: builderClient.did,
      name: 'Data Access Manager'
    })

    // Generate user keypair for access control
    const userKeyPair = await generateKeyPair()
    const userDid = userKeyPair.did

    // Initialize User Client
    const userClient = new SecretVaultUserClient({
      keypair: userKeyPair,
      urls: {
        chain: 'http://rpc.testnet.nilchain-rpc-proxy.nilogy.xyz',
        auth: 'https://nilauth.sandbox.app-cluster.sandbox.nilogy.xyz',
        dbs: [
          'https://nildb-stg-n1.nillion.network',
          'https://nildb-stg-n2.nillion.network',
          'https://nildb-stg-n3.nillion.network'
        ]
      },
      blindfold: { operation: 'store' }
    })

    // Refresh authentication tokens
    await userClient.refreshRootToken()

    console.log('Nillion access control initialized:', {
      builderDid: builderClient.did,
      userDid: userDid
    });
    ```

  </Step>

  <Step>
    ### Create Delegation Tokens

    Generate delegation tokens for secure, time-limited access:

    ```javascript
    // Create delegation token for user access
    async function createDelegationToken(userDid, expirationHours = 24) {
      const expiresAt = Math.floor(Date.now() / 1000) + (expirationHours * 60 * 60)

      const delegationToken = await builderClient.createDelegationToken({
        audience: userDid,
        expiresAt: expiresAt
      })

      return delegationToken
    }

    // Create token for specific user
    const delegationToken = await createDelegationToken(userDid, 24) // 24 hours
    console.log('Delegation token created:', delegationToken);
    ```

  </Step>

  <Step>
    ### Set Up Access Control and Validation

    Configure granular permissions and implement access validation:

    ```javascript
    // Define access control permissions
    const accessControlList = {
      granteeDid: userDid,
      read: true,    // User can read the data
      write: false,  // User cannot modify the data
      execute: true  // User can execute computations on the data
    }

    // Create owned collection with access control
    const ownedCollection = await builderClient.createCollection({
      name: 'Encrypted Data Keys',
      collectionType: 'owned',
      schema: {
        type: 'object',
        properties: {
          arweave_tx_id: { type: 'string' },
          encryption_key: { type: 'string', secret: true },
          encryption_iv: { type: 'string', secret: true },
          user_id: { type: 'string' },
          created_at: { type: 'string' }
        },
        required: ['arweave_tx_id', 'encryption_key', 'encryption_iv', 'user_id']
      }
    })

    // Access validation function
    async function validateNillionAccess(userDid, arweaveTxId) {
      try {
        // Check if user has access to the decryption key
        const ownedRecords = await userClient.listDataReferences();

        const keyRecord = ownedRecords.find(record =>
          record.collection === ownedCollection.id &&
          record.document &&
          record.document.arweave_tx_id === arweaveTxId
        );

        if (!keyRecord) {
          throw new Error('Access denied: No decryption key found for this data');
        }

        // Read the specific record to verify access
        const recordData = await userClient.readData({
          collection: ownedCollection.id,
          document: keyRecord.document._id
        });

        return {
          authorized: true,
          keyRecord: recordData,
          permissions: {
            read: true,
            write: false,
            execute: true
          }
        };

      } catch (error) {
        console.error('Nillion access validation failed:', error);
        return { authorized: false, error: error.message };
      }
    }

    // Grant access to additional users
    async function grantUserAccess(granteeDid, arweaveTxId) {
      const ownedRecords = await userClient.listDataReferences();
      const keyRecord = ownedRecords.find(record =>
        record.collection === ownedCollection.id &&
        record.document &&
        record.document.arweave_tx_id === arweaveTxId
      );

      if (keyRecord) {
        await userClient.grantAccess({
          collection: ownedCollection.id,
          document: keyRecord.document._id,
          grantee: granteeDid,
          read: true,
          write: false,
          execute: true
        });
        console.log(`Access granted to ${granteeDid} for data ${arweaveTxId}`);
      }
    }

    console.log('Access control system configured:', ownedCollection.id);
    ```

  </Step>
</Steps>

## Getting Started with Encrypted Data Storage

<Steps>
  <Step>
    ### Prepare and Encrypt Your Data

    Encrypt your sensitive data before uploading to Arweave. Here's an example for financial records:

    ```javascript
    import CryptoJS from "crypto-js";

    // Prepare your sensitive data
    const sensitiveData = {
      "user_id": "user_12345",
      "account_balance": 50000,
      "transaction_history": [
        { "date": "2025-01-15", "amount": 1000, "type": "deposit" },
        { "date": "2025-01-14", "amount": -500, "type": "withdrawal" }
      ],
      "credit_score": 750
    };

    // Generate encryption key and IV
    const secretKey = CryptoJS.lib.WordArray.random(256/8);
    const iv = CryptoJS.lib.WordArray.random(128/8);

    // Encrypt the data using AES-256-GCM
    const encryptedData = CryptoJS.AES.encrypt(
      JSON.stringify(sensitiveData),
      secretKey,
      {
        iv: iv,
        mode: CryptoJS.mode.GCM,
        padding: CryptoJS.pad.NoPadding
      }
    ).toString();

    // Prepare encryption key for Nillion storage
    const encryptionKey = {
      key: secretKey.toString(CryptoJS.enc.Base64),
      iv: iv.toString(CryptoJS.enc.Base64)
    };
    ```

    **Best Practices:**
    - Use strong, randomly generated keys (256-bit for AES-256)
    - Include initialization vectors (IV) for each encryption
    - Store keys separately from encrypted data
    - Use authenticated encryption (AES-256-GCM) for integrity and confidentiality
    - GCM mode provides built-in authentication preventing tampering

    For detailed encryption methods, see our [Encryption documentation](/build/upload/encryption).

  </Step>

  <Step>
    ### Upload Encrypted Data to Arweave

    Upload your encrypted data with proper tags for identification:

    <Tabs items={['Turbo SDK', 'Turbo CLI']}>
      <Tab value="Turbo SDK">

        ```typescript
        import { TurboFactory } from '@ardrive/turbo-sdk'

        // Initialize with your wallet
        const turbo = await TurboFactory.authenticated({
          privateKey: jwk, // Your Arweave wallet
          token: 'arweave'
        })

        // Upload encrypted data
        const result = await turbo.upload({
          data: encryptedData,
          dataItemOpts: {
            tags: [
              { name: "Content-Type", value: "application/octet-stream" },
              { name: "App-Name", value: "SecureData-v1.0" },
              { name: "Encrypted", value: "true" },
              { name: "Cipher", value: "AES-256-GCM" },
              { name: "Cipher-IV", value: iv.toString(CryptoJS.enc.Base64) },
              { name: "Data-Type", value: "Financial-Records" },
              { name: "User-ID", value: "user_12345" },
              { name: "Access-Level", value: "Authorized-Users-Only" }
            ]
          }
        })

        console.log("Encrypted data uploaded to Arweave:", result.id);
        ```

      </Tab>

      <Tab value="Turbo CLI">

        ```bash
        # Install Turbo CLI
        npm install -g @ardrive/turbo-sdk

        # Upload encrypted file
        turbo upload-file --file-path encrypted-data.bin \
          --tag "Content-Type:application/octet-stream" \
          --tag "App-Name:SecureData-v1.0" \
          --tag "Encrypted:true" \
          --tag "Cipher:AES-256-GCM" \
          --tag "Cipher-IV:base64-encoded-iv" \
          --tag "Data-Type:Financial-Records" \
          --tag "User-ID:user_12345" \
          --tag "Access-Level:Authorized-Users-Only"
        ```

      </Tab>
    </Tabs>

    For advanced uploading options, see our [Advanced Uploading with Turbo](/build/upload/advanced-uploading-with-turbo) guide.

  </Step>

  <Step>
    ### Store Decryption Key on Nillion

    **Recommended: Use Collection Explorer**
    - Visit [Collection Explorer](https://collection-explorer.nillion.com)
    - Create a collection for decryption keys with proper schema
    - Define field types and access permissions
    - Export collection configuration for SDK use

    **Alternative: Programmatic Creation with Access Control**
    ```javascript
    // Store decryption key using owned collection with access control
    const keyRecord = await userClient.createData({
      collection: ownedCollection.id,
      owner: userDid,
      data: [{
        arweave_tx_id: result.id, // Reference to encrypted data on Arweave
        encryption_key: encryptionKey.key,
        encryption_iv: encryptionKey.iv,
        user_id: userDid,
        created_at: new Date().toISOString(),
        data_type: 'financial_records',
        description: 'Decryption key for financial data on Arweave'
      }],
      acl: [accessControlList], // Grant specific permissions
      delegationToken: delegationToken
    });

    console.log("Decryption key stored on Nillion with access control:", keyRecord);
    ```

    **Key Management:**
    - Decryption keys are encrypted and split across multiple nilDB nodes
    - Only authorized users can access the keys
    - Keys are never exposed to the network during computation
    - Access permissions are cryptographically enforced

  </Step>

</Steps>

## Setting Up Blind Computing with nilCC

<Steps>
  <Step>
    ### Create Docker Container for nilCC Workload

    Create a Docker container that will run in a confidential VM with AMD SEV-SNP security:

    **Create `docker-compose.yaml`:**
    ```yaml
    version: '3.8'
    services:
      decrypt-service:
        build: ./app
        environment:
          - ARWEAVE_GATEWAY=https://arweave.net
          - NODE_ENV=production
        ports:
          - "8080:8080"
    ```

    **Create `app/Dockerfile`:**
    ```dockerfile
    FROM node:18-alpine

    WORKDIR /app

    # Copy package files
    COPY package*.json ./

    # Install dependencies
    RUN npm ci --only=production

    # Copy application code
    COPY . .

    # Build TypeScript
    RUN npm run build

    # Expose port
    EXPOSE 8080

    # Run the application
    CMD ["node", "dist/server.js"]
    ```

    **Create `app/package.json`:**
    ```json
    {
      "name": "nilcc-blind-decrypt",
      "version": "1.0.0",
      "scripts": {
        "build": "tsc",
        "start": "node dist/server.js"
      },
      "dependencies": {
        "express": "^4.18.2",
        "crypto-js": "^4.2.0"
      },
      "devDependencies": {
        "@types/express": "^4.17.21",
        "@types/crypto-js": "^4.2.1",
        "@types/node": "^20.10.0",
        "typescript": "^5.3.3"
      }
    }
    ```

    **Create `app/tsconfig.json`:**
    ```json
    {
      "compilerOptions": {
        "target": "ES2020",
        "module": "commonjs",
        "outDir": "./dist",
        "rootDir": "./src",
        "strict": true,
        "esModuleInterop": true,
        "skipLibCheck": true,
        "forceConsistentCasingInFileNames": true
      },
      "include": ["src/**/*"],
      "exclude": ["node_modules"]
    }
    ```

    **Create `app/src/server.ts`:**
    ```typescript
    import express, { Request, Response } from 'express';
    import CryptoJS from 'crypto-js';

    const app = express();
    const PORT = 8080;
    const ARWEAVE_GATEWAY = process.env.ARWEAVE_GATEWAY || 'https://arweave.net';

    app.use(express.json());

    interface DecryptRequest {
      arweave_tx_id: string;
      encryption_key: string;
      encryption_iv: string;
    }

    interface FinancialData {
      user_id: string;
      account_balance: number;
      transaction_history: Array<{
        date: string;
        amount: number;
        type: string;
      }>;
      credit_score: number;
    }

    app.post('/decrypt', async (req: Request, res: Response) => {
      try {
        const { arweave_tx_id, encryption_key, encryption_iv } = req.body as DecryptRequest;

        // 1. Fetch encrypted data from Arweave
        console.log(`Fetching encrypted data from Arweave: ${arweave_tx_id}`);
        const arweaveUrl = `${ARWEAVE_GATEWAY}/${arweave_tx_id}`;
        const arweaveResponse = await fetch(arweaveUrl);
        const encryptedData = await arweaveResponse.text();

        // 2. Decrypt within the confidential VM (TEE) using AES-256-GCM
        const key = CryptoJS.enc.Base64.parse(encryption_key);
        const iv = CryptoJS.enc.Base64.parse(encryption_iv);

        const decrypted = CryptoJS.AES.decrypt(encryptedData, key, {
          iv: iv,
          mode: CryptoJS.mode.GCM,
          padding: CryptoJS.pad.NoPadding
        });
        const decryptedText = decrypted.toString(CryptoJS.enc.Utf8);
        const decryptedData: FinancialData = JSON.parse(decryptedText);

        // 3. Process data without exposing raw content
        const transactionHistory = decryptedData.transaction_history || [];
        const totalTransactions = transactionHistory.reduce(
          (sum, t) => sum + t.amount,
          0
        );

        const processedResults = {
          total_balance: decryptedData.account_balance || 0,
          transaction_count: transactionHistory.length,
          average_transaction: transactionHistory.length > 0
            ? totalTransactions / transactionHistory.length
            : 0,
          credit_score: decryptedData.credit_score || 0,
          user_id: decryptedData.user_id || 'unknown'
        };

        // 4. Return only processed results (raw data never leaves TEE)
        res.json({
          success: true,
          results: processedResults
        });

      } catch (error) {
        console.error('Decryption error:', error);
        res.status(500).json({
          success: false,
          error: error instanceof Error ? error.message : 'Unknown error'
        });
      }
    });

    app.listen(PORT, () => {
      console.log(`Blind decryption service running in confidential VM on port ${PORT}`);
    });
    ```

  </Step>

  <Step>
    ### Deploy Workload to nilCC

    Deploy your Docker container as a confidential workload on Nillion's nilCC platform:

    ```bash
    # Deploy to nilCC (this creates a Confidential VM with AMD SEV-SNP)
    # When you deploy, nilCC:
    # 1. Creates a Confidential VM with AMD SEV-SNP hardware security
    # 2. Packages your workload as an ISO with docker-compose.yaml
    # 3. Boots securely with dm-verity filesystem verification and LUKS encryption
    # 4. Deploys containers with automatic TLS certificates via Caddy
    # 5. Generates attestation linking your TLS certificate to hardware measurements

    nilcc deploy \
      --compose docker-compose.yaml \
      --name financial-decryptor \
      --env ARWEAVE_GATEWAY=https://arweave.net
    ```

    **What Happens Behind the Scenes:**
    - Creates a **Confidential VM** with **AMD SEV-SNP** hardware security
    - Packages your workload as an **ISO** with `docker-compose.yaml`, metadata, and environment variables
    - Boots securely with **dm-verity** filesystem verification and **LUKS** encryption
    - Deploys containers with automatic **TLS certificates** via Caddy
    - Generates **attestation** linking your TLS certificate to hardware measurements

  </Step>

  <Step>
    ### Execute Blind Decryption Workflow

    Set up a workflow that retrieves the decryption key from nilDB and calls your nilCC workload:

    ```javascript
    // Complete blind decryption workflow
    async function executeBlindDecryption(userDid, arweaveTxId, workloadEndpoint) {
      try {
        // 1. Validate access using the access control system
        const access = await validateNillionAccess(userDid, arweaveTxId);

        if (!access.authorized) {
          throw new Error('Access denied: ' + access.error);
        }

        // 2. Use the validated key data
        const keyData = access.keyRecord;

        // 3. Call the nilCC workload with decryption parameters
        // The workload runs in a confidential VM with AMD SEV-SNP
        const response = await fetch(workloadEndpoint, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            arweave_tx_id: arweaveTxId,
            encryption_key: keyData.encryption_key,
            encryption_iv: keyData.encryption_iv
          })
        });

        const result = await response.json();

        if (!result.success) {
          throw new Error('Blind decryption failed: ' + result.error);
        }

        // 4. Return processed results with attestation
        return {
          success: true,
          results: result.results,
          arweaveTxId: arweaveTxId,
          attestation: response.headers.get('X-Attestation'), // AMD SEV-SNP attestation
          tlsCertHash: response.headers.get('X-TLS-Cert-Hash') // Proves secure connection
        };

      } catch (error) {
        console.error('Blind decryption workflow failed:', error);
        return { success: false, error: error.message };
      }
    }

    // Example usage
    const workloadUrl = 'https://your-nilcc-workload.nillion.network';
    const results = await executeBlindDecryption(userDid, result.id, workloadUrl);
    console.log('Blind decryption results:', results);
    ```

    **Security Guarantees:**
    - Decryption happens **inside AMD SEV-SNP confidential VM**
    - Keys are retrieved from nilDB only for authorized users
    - Raw data never leaves the TEE
    - Cryptographic **attestation** proves secure execution
    - **TLS certificate** linked to hardware measurements

  </Step>

</Steps>

## Next Steps

<Cards>
<Card
  href="/build/upload/advanced-uploading-with-turbo"
  title="Advanced Uploading with Turbo"
  icon={<Database />}
>
  Learn advanced uploading techniques for large encrypted datasets and batch processing.
</Card>

<Card
  href="/build/upload/encryption"
  title="Encryption Best Practices"
  icon={<Lock />}
>
  Explore comprehensive encryption strategies and security considerations.
</Card>

<Card
  href="https://docs.nillion.com/build/private-storage/quickstart"
  title="Nillion Private Storage"
  icon={<Key />}
>
  Deep dive into Nillion's nilDB for secure key storage and management.
</Card>

<Card
  href="https://docs.nillion.com/build/private-storage/ts-docs"
  title="SecretVaults SDK Docs"
  icon={<Shield />}
>
  Learn more about Nillion's native access control and delegation tokens.
</Card>

</Cards>

## Need Help?

If you're interested in implementing encrypted data storage with blind computing, join our [Discord community](https://discord.gg/cuCqBb5v) or explore the [Nillion developer resources](https://docs.nillion.com) for detailed implementation guides.
