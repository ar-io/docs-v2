import { CodeGroup } from '@/components/Code'

export const metadata = {
  title: 'buyRecord (manual)',
  description:
    'Purchase an ArNS record for a specified name and duration with manual ANT creation',
  openGraph: {
    title: 'buyRecord (manual)',
  },
}

# buyRecord

`buyRecord` is a method on the `ARIO` class that purchases a record in the ArNS registry for a specified name and duration.

`buyRecord` requires authentication.

<Tip title="Important: ANT Process ID">
  The `processId` parameter must be the process ID of an **ANT (Arweave Name
  Token)** that you own or control. You cannot use the ARIO contract address or
  create ANTs automatically through this method. **You must create your ANT
  separately before calling `buyRecord`.**
</Tip>

## Examples

<CodeGroup title="buyRecord">

    ```typescript {{title: "Basic"}}
    const { id: txId } = await ario.buyRecord({
        name: 'mydomain',
        years: 1,
        processId: antProcessId,
        type: 'lease'
    });
    ```

    ```typescript {{title: "Complete Workflow - NodeJS"}}
    const fs = require("fs");
    const {
      ARIO,
      ANT,
      ANTRegistry,
      ArweaveSigner,
      spawnANT,
      createAoSigner,
      initANTStateForAddress
    } = require("@ar.io/sdk");

    async function main() {
        const jwk = JSON.parse(fs.readFileSync("KeyFile.json"));
        const signer = new ArweaveSigner(jwk);
        const aoSigner = createAoSigner(signer);

        // Get latest ANT version
        const antVersions = ANT.versions.init();
        const latestVersion = await antVersions.getLatestANTVersion();

        // Spawn ANT process
        const antState = initANTStateForAddress({
            owner: signer.address,
            name: 'My Awesome Domain',
            ticker: 'MAD',
            description: 'My awesome ArNS domain'
        });

        const antProcessId = await spawnANT({
            signer: aoSigner,
            module: latestVersion.moduleId,
            state: antState
        });

        // Configure ANT
        const ant = ANT.init({
            signer,
            processId: antProcessId
        });

        await ant.setName({ name: 'My Awesome Domain' });
        await ant.setTicker({ ticker: 'MAD' });

        // Register ANT with registry
        const antRegistry = ANTRegistry.init({ signer });
        await antRegistry.register({ processId: antProcessId });

        // Wait for registration to be processed
        let isRegistered = false;
        let attempts = 0;
        while (!isRegistered && attempts < 15) {
            await new Promise(resolve => setTimeout(resolve, 2000 * (attempts + 1)));
            try {
                const acl = await antRegistry.accessControlList({ address: signer.address });
                isRegistered = [...acl.Owned, ...acl.Controlled].includes(antProcessId);
                attempts++;
            } catch (error) {
                attempts++;
            }
        }

        if (!isRegistered) {
            throw new Error('Failed to register ANT after multiple attempts');
        }

        // Purchase ArNS name
        const ario = ARIO.init({ signer });
        const { id: txId } = await ario.buyRecord({
            name: 'mydomain',
            years: 1,
            processId: antProcessId,
            type: 'lease',
            fundFrom: 'balance'
        });

        console.log('ArNS name purchased successfully!');
        console.log('Transaction ID:', txId);
        console.log('ANT Process ID:', antProcessId);
    }

    main().catch(console.error);
    ```

    ```typescript {{ title: 'Complete Workflow - Web' }}
    import {
      ARIO,
      ANT,
      ANTRegistry,
      ArConnectSigner,
      spawnANT,
      createAoSigner,
      initANTStateForAddress
    } from '@ar.io/sdk/web';

    async function main() {
        // Connect wallet
        await window.arweaveWallet.connect([
          'ACCESS_ADDRESS',
          'ACCESS_ALL_ADDRESSES',
          'ACCESS_PUBLIC_KEY',
          'SIGN_TRANSACTION',
          'ACCESS_ARWEAVE_CONFIG',
          'SIGNATURE',
        ]);
        const signer = new ArConnectSigner(window.arweaveWallet);
        const aoSigner = createAoSigner(signer);

        // Get latest ANT version
        const antVersions = ANT.versions.init();
        const latestVersion = await antVersions.getLatestANTVersion();

        // Spawn ANT process
        const antState = initANTStateForAddress({
            owner: signer.address,
            name: 'My Awesome Domain',
            ticker: 'MAD',
            description: 'My awesome ArNS domain'
        });

        const antProcessId = await spawnANT({
            signer: aoSigner,
            module: latestVersion.moduleId,
            state: antState
        });

        // Configure ANT
        const ant = ANT.init({
            signer,
            processId: antProcessId
        });

        await ant.setName({ name: 'My Awesome Domain' });
        await ant.setTicker({ ticker: 'MAD' });

        // Register ANT with registry
        const antRegistry = ANTRegistry.init({ signer });
        await antRegistry.register({ processId: antProcessId });

        // Wait for registration to be processed
        let isRegistered = false;
        let attempts = 0;
        while (!isRegistered && attempts < 15) {
            await new Promise(resolve => setTimeout(resolve, 2000 * (attempts + 1)));
            try {
                const acl = await antRegistry.accessControlList({ address: signer.address });
                isRegistered = [...acl.Owned, ...acl.Controlled].includes(antProcessId);
                attempts++;
            } catch (error) {
                attempts++;
            }
        }

        if (!isRegistered) {
            throw new Error('Failed to register ANT after multiple attempts');
        }

        // Purchase ArNS name
        const ario = ARIO.init({ signer });
        const { id: txId } = await ario.buyRecord({
            name: 'mydomain',
            years: 1,
            processId: antProcessId,
            type: 'lease',
            fundFrom: 'balance'
        });

        console.log('ArNS name purchased successfully!');
        console.log('Transaction ID:', txId);
        console.log('ANT Process ID:', antProcessId);
    }

    main().catch(console.error);
    ```

    ```typescript {{ title: 'Using Existing ANT' }}
    import { ARIO, ArConnectSigner } from '@ar.io/sdk/web';

    async function main() {
        // Connect wallet
        await window.arweaveWallet.connect([
            'ACCESS_ADDRESS',
            'ACCESS_ALL_ADDRESSES',
            'ACCESS_PUBLIC_KEY',
            'SIGN_TRANSACTION',
            'ACCESS_ARWEAVE_CONFIG',
            'SIGNATURE',
          ]);
        const signer = new ArConnectSigner(window.arweaveWallet);
        const existingAntProcessId = 'your-existing-ant-process-id';

        const ario = ARIO.init({ signer });
        const { id: txId } = await ario.buyRecord({
            name: 'mydomain',
            years: 1,
            processId: existingAntProcessId,
            type: 'lease'
        });

        console.log('ArNS name purchased successfully!');
        console.log('Transaction ID:', txId);
        console.log('ANT Process ID:', existingAntProcessId);
    }

    main().catch(console.error);
    ```

</CodeGroup>

## Parameters

<Table>
  <Table.Head>
    <Table.Row>
      <Table.Header>Parameter</Table.Header>
      <Table.Header>Type</Table.Header>
      <Table.Header>Description</Table.Header>
      <Table.Header>Optional</Table.Header>
    </Table.Row>
  </Table.Head>
  <Table.Body>
    <Table.Row>
      <Table.Cell className="font-semibold">name</Table.Cell>
      <Table.Cell>string</Table.Cell>
      <Table.Cell>The ArNS name to purchase</Table.Cell>
      <Table.Cell>false</Table.Cell>
    </Table.Row>
    <Table.Row>
      <Table.Cell className="font-semibold">years</Table.Cell>
      <Table.Cell>number</Table.Cell>
      <Table.Cell>The number of years to lease the name for (1-5)</Table.Cell>
      <Table.Cell>false</Table.Cell>
    </Table.Row>
    <Table.Row>
      <Table.Cell className="font-semibold">processId</Table.Cell>
      <Table.Cell>string</Table.Cell>
      <Table.Cell>
        The ANT process ID to set for this name. Must be an existing ANT that
        you own or control
      </Table.Cell>
      <Table.Cell>false</Table.Cell>
    </Table.Row>
    <Table.Row>
      <Table.Cell className="font-semibold">type</Table.Cell>
      <Table.Cell>string</Table.Cell>
      <Table.Cell>The type of purchase: 'lease' or 'permabuy'</Table.Cell>
      <Table.Cell>true</Table.Cell>
    </Table.Row>
    <Table.Row>
      <Table.Cell className="font-semibold">fundFrom</Table.Cell>
      <Table.Cell>string</Table.Cell>
      <Table.Cell>
        The source of funds: 'balance', 'stakes', 'any', or 'turbo'
      </Table.Cell>
      <Table.Cell>true</Table.Cell>
    </Table.Row>
    <Table.Row>
      <Table.Cell className="font-semibold">paidBy</Table.Cell>
      <Table.Cell>string | string[]</Table.Cell>
      <Table.Cell>
        Wallet address(es) that will pay for the purchase (used with fundFrom:
        'turbo')
      </Table.Cell>
      <Table.Cell>true</Table.Cell>
    </Table.Row>
    <Table.Row>
      <Table.Cell className="font-semibold">tags</Table.Cell>
      <Table.Cell>array</Table.Cell>
      <Table.Cell>
        An array of GQL tag objects to attach to the transfer AO message
      </Table.Cell>
      <Table.Cell>true</Table.Cell>
    </Table.Row>
  </Table.Body>
</Table>
